<?php

namespace Database\Seeders;

use App\Models\Industry;
use App\Models\JobGroup;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class JobGroupSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Get the first industry as default (industry_id is required)
        $defaultIndustry = Industry::first();
        
        if (!$defaultIndustry) {
            $this->command->warn('No industry found. Please seed industries first.');
            return;
        }

        $jobGroups = [
            [
                'name' => 'فروش، بازاریابی و خدمات',
                'children' => [
                    'فروش و بازاریابی – سطوح کارشناسی و مدیریتی',
                    'فروش و بازاریابی – فروشنده / بازاریاب / ویزیتور / صندوقدار',
                    'مدیر فروشگاه / مدیر رستوران',
                    'خدمات و پشتیبانی مشتریان',
                    'نماینده علمی / مدرپ',
                    'مدیریت منابع',
                    'دیجیتال مارکتینگ و سئو',
                    'ترجمه / تولید محتوا / نویسندگی و ویراستاری',
                ]
            ],
            [
                'name' => 'نرم‌افزار، فناوری و طراحی',
                'children' => [
                    'توسعه نرم‌افزار و برنامه‌نویسی',
                    'تست نرم‌افزار',
                    'شبکه / DevOps / پشتیبانی سخت‌افزار و نرم‌افزار',
                    'علوم داده / هوش مصنوعی',
                    'طراحی بازی',
                    'طراحی گرافیک / طراحی انیمیشن و موشن گرافیک',
                    'طراحی لباس / طراحی طلا و جواهر',
                    'طراحی صنعتی / نقشه‌کشی صنعتی',
                    'عکاسی',
                ]
            ],
            [
                'name' => 'هنر، رسانه، فناوری محصول',
                'children' => [
                    'مشاغل حوزه فیلم و سینما',
                    'طراحی موسیقی و صدا',
                    'طراحی رابط و تجربه کاربری (UI/UX)',
                    'مدیر محصول / مالک محصول',
                    'تحلیل و توسعه کسب‌وکار / استراتژی / برنامه‌ریزی',
                    'مهندسی صنایع / مدیریت تولید / مدیریت پروژه / مدیریت عملیات',
                    'خرید / تدارکات',
                    'بازرگانی / تجارت',
                ]
            ],
            [
                'name' => 'مالی، اداری و منابع انسانی',
                'children' => [
                    'لجستیک / حمل‌ونقل / انبارداری',
                    'راننده / مسئول توزیع / پیک موتوری',
                    'مالی و حسابداری',
                    'معامله‌گر و تحلیل‌گر بازارهای مالی',
                    'تحصیل‌دار / کارپرداز',
                    'مسئول دفتر / کارشناس اداری / ثبت اطلاعات / اپراتور',
                    'منابع انسانی',
                    'مدیر اجرایی / مدیر داخلی',
                    'مدیرعامل / مدیر ارشد',
                ]
            ],
            [
                'name' => 'مهندسی',
                'children' => [
                    'مهندسی برق',
                    'مهندسی پزشکی',
                    'مهندسی مکانیک / مهندسی هوافضا',
                    'مهندسی صنایع غذایی',
                    'مهندسی شیمی / مهندسی نفت و گاز',
                    'مهندسی انرژی / مهندسی هسته‌ای',
                    'بهداشت، ایمنی و محیط‌زیست (HSE)',
                    'مهندسی عمران',
                    'مهندسی معماری و شهرسازی',
                    'مهندسی معدن / زمین‌شناسی',
                    'مهندسی مواد و متالورژی',
                    'مهندسی نساجی',
                    'مهندسی پلیمر',
                    'مهندسی کشاورزی / علوم دامی',
                ]
            ],
            [
                'name' => 'علوم، پزشکی و اجتماعی',
                'children' => [
                    'زیست‌شناسی / علوم زیستی / علوم آزمایشگاهی',
                    'داروسازی / بیوشیمی / شیمی',
                    'پزشک / دندان‌پزشک / دامپزشک',
                    'پرستار و بهیار / تکنسین سلامت و درمان / دستیار پزشک',
                    'پرستار سالمند / پرستار کودک',
                    'روانشناسی / مشاوره / علوم اجتماعی',
                    'حقوقی',
                    'روابط عمومی',
                    'خبرنگار / روزنامه‌نگار',
                    'آموزش / تدریس',
                    'پژوهش',
                ]
            ],
            [
                'name' => 'فنی، تولیدی و خدمات',
                'children' => [
                    'نگهبان',
                    'کارگر ساده / نیروی خدماتی',
                    'تکنسین فنی / تعمیر کار / کارگر ماهر',
                    'تخصص‌های ساختمانی (بتن، گچ‌کار، کاشی‌کار، و…)',
                    'نجار / MDF کار / کابینت‌کار / مبل‌ساز / رنگ‌کار چوب',
                    'آرایشگر',
                    'قناد و شیرینی‌پز',
                    'بافنده فرش (قالی‌باف)',
                    'نانوا',
                ]
            ],
            [
                'name' => 'مشاغل مختلف آزاد',
                'children' => [
                    'قفل‌ساز و کلید ساز',
                    'قصاب',
                    'کفاش',
                    'خیاط',
                    'آشپز',
                    'باریستا / کافی‌من / گارسون',
                    'راهنمای تور / مهماندار',
                    'ورزش / تربیت بدنی / تغذیه',
                    'تاریخ / جغرافیا / باستان‌شناسی',
                ]
            ],
        ];

        foreach ($jobGroups as $group) {
            // Create parent job group
            $parent = JobGroup::firstOrCreate(
                [
                    'name' => $group['name'],
                ],
                [
                    'industry_id' => $defaultIndustry->id,
                    'parent_id' => null,
                ]
            );

            // Update parent_id if it was null (in case it already existed)
            if ($parent->parent_id !== null) {
                $parent->update(['parent_id' => null]);
            }

            // Create child job groups
            foreach ($group['children'] as $childName) {
                JobGroup::firstOrCreate(
                    [
                        'name' => $childName,
                    ],
                    [
                        'industry_id' => $defaultIndustry->id,
                        'parent_id' => $parent->id,
                    ]
                );
            }
        }
    }
}
